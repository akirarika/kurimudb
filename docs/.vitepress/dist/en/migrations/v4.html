<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>General | Kurimudb</title>
    <meta name="description" content="Just playing around.">
    <link rel="stylesheet" href="/assets/style.9de7d475.css">
    <link rel="modulepreload" href="/assets/Home.bd9d24f4.js">
    <link rel="modulepreload" href="/assets/app.cb718f31.js">
    <link rel="modulepreload" href="/assets/en_migrations_v4.md.e12f25ee.lean.js">
    <link rel="modulepreload" href="/assets/app.cb718f31.js">
    <link rel="icon" href="favicon.png">
    <meta name="twitter:title" content="General | Kurimudb">
    <meta property="og:title" content="General | Kurimudb">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/en/" aria-label="Kurimudb, back to home" data-v-675d8756 data-v-4a583abe><!----> Kurimudb</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/akirarika/kurimudb/releases" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>Changelog <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/akirarika/kurimudb" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>Github <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><div class="item" data-v-eab3edfe><div class="nav-dropdown-link" data-v-eab3edfe data-v-56bf3a3f><button class="button" data-v-56bf3a3f><span class="button-text" data-v-56bf3a3f>Languages</span><span class="right button-arrow" data-v-56bf3a3f></span></button><ul class="dialog" data-v-56bf3a3f><!--[--><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/migrations/v4.html" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>简体中文</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item active" href="/en/migrations/v4.html" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>English</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><!--]--></ul></div></div><!----></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/akirarika/kurimudb/releases" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>Changelog <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/akirarika/kurimudb" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>Github <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><div class="item" data-v-eab3edfe><div class="nav-dropdown-link" data-v-eab3edfe data-v-56bf3a3f><button class="button" data-v-56bf3a3f><span class="button-text" data-v-56bf3a3f>Languages</span><span class="right button-arrow" data-v-56bf3a3f></span></button><ul class="dialog" data-v-56bf3a3f><!--[--><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/migrations/v4.html" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>简体中文</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item active" href="/en/migrations/v4.html" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>English</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><!--]--></ul></div></div><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><p class="sidebar-link-item">文档(English)</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/en/docs/intro/">入门(English)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/en/docs/model/">模型(English)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/en/docs/persistence/">持久化(English)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/en/docs/subscribe/">订阅变更(English)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/en/docs/typescript/">TypeScript(English)</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">驱动(English)</p><ul class="sidebar-links"><li class="sidebar-link"><p class="sidebar-link-item">浏览器驱动(English)</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/en/drivers/localstorage">LocalStorage(English)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/en/drivers/cookie">Cookie(English)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/en/drivers/dexie">Dexie (IndexedDB)(English)</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">其他驱动(English)</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/en/drivers/taro">Taro(English)</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/en/drivers/custom-driver">自定义驱动(English)</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">迁移(English)</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/en/migrations/v3">从 v3 迁移(English)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/en/migrations/v4">从 v4 迁移(English)</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#总览">总览</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#破坏性变化">破坏性变化</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#主键类型变更为-string">主键类型变更为 string</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#继承模型拆分为同步模型和异步模型">继承模型拆分为同步模型和异步模型</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#驱动重写">驱动重写</a><!----></li></ul></li></ul></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/en/bestPractices/">最佳实践(English)</a><!----></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><!-- # Migrate from Version 4

Compared with the 4.x version, Kurimudb 5.x has many changes. They may be some new features or some incompatible changes. This document will elaborate on the specific changes for you.

## General

Kurimudb 5.x version mainly made some following improvements:

1. Overall refactoring, perfect testing, optimize code readability;

2. More complete and rigorous TypeScript type support, and added a lot of automatic inference, thank you very much for the help provided by [@TheNightmareX](https://github.com/TheNightmareX)

3. In addition to auto-increment, the primary key of the collection model can also be customized now. We can use distributed ID generation algorithms such as Snowflake ID and UUID to generate the primary key to develop cloud synchronization functions. We can also create a custom algorithm to satisfy Business needs.

4. To be continued...

## Discruptive Changes

### Change the Primary Key Type to String

In the old version, the primary key of the model is divided into two types: `string` and `number`. --><h1 id="从-v4-迁移" tabindex="-1">从 v4 迁移 <a class="header-anchor" href="#从-v4-迁移" aria-hidden="true">#</a></h1><p>Kurimudb 5.x 版本相较于 4.x 版本有许多变化，它们可能是一些新特性，也可能是一些不兼容的更改，本文档会详细为你阐述其中的具体变化。</p><h2 id="总览" tabindex="-1">总览 <a class="header-anchor" href="#总览" aria-hidden="true">#</a></h2><p>Kurimudb 5.x 版本主要做了以下方向的改进：</p><ol><li><p>整体重构，完善测试，优化代码可读性</p></li><li><p>更加完善和严谨的 TypeScript 类型支持，并且增加了很多自动推断，非常感谢 <a href="https://github.com/TheNightmareX" target="_blank" rel="noopener noreferrer">@TheNightmareX</a> 提供的帮助</p></li><li><p>集合模型的主键，除了自动递增以外，还可以自定义生成方式：我们可以使用诸如 Snowflake ID、UUID 等分布式 ID 生成算法来生成主键，以便开发云端同步功能，也可以通过创建自定义算法来满足业务需求</p></li><li><p>将异步模型与同步模型的代码拆分，便于后续维护</p></li></ol><h2 id="破坏性变化" tabindex="-1">破坏性变化 <a class="header-anchor" href="#破坏性变化" aria-hidden="true">#</a></h2><h3 id="主键类型变更为-string" tabindex="-1">主键类型变更为 string <a class="header-anchor" href="#主键类型变更为-string" aria-hidden="true">#</a></h3><p>旧版本中，模型的主键区分为 <code>string</code> 与 <code>number</code> 两种类型，5.x 版本开始将统一为 <code>string</code> 类型，同时模型选项中不再需要声明 <code>type</code> 字段。</p><h3 id="继承模型拆分为同步模型和异步模型" tabindex="-1">继承模型拆分为同步模型和异步模型 <a class="header-anchor" href="#继承模型拆分为同步模型和异步模型" aria-hidden="true">#</a></h3><div class="language-js line-numbers-mode"><pre><code><span class="token keyword">class</span> <span class="token class-name">noteList</span> <span class="token keyword">extends</span> <span class="token class-name">Models<span class="token punctuation">.</span>collection</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token comment">// 变更为</span>
<span class="token keyword">class</span> <span class="token class-name">noteList</span> <span class="token keyword">extends</span> <span class="token class-name">SyncModels<span class="token punctuation">.</span>collection</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token comment">// 或者</span>
<span class="token keyword">class</span> <span class="token class-name">noteList</span> <span class="token keyword">extends</span> <span class="token class-name">AsyncModels<span class="token punctuation">.</span>collection</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="驱动重写" tabindex="-1">驱动重写 <a class="header-anchor" href="#驱动重写" aria-hidden="true">#</a></h3><p>所有驱动同样需要升级到 5.x 版本，可能部分驱动的 Api 有变动</p></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><!----></div></div><div class="updated" data-v-fb8d84c6><!----></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/en/migrations/v3" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>从 v3 迁移(English)</span></a></div><div class="next" data-v-38ede35f><a class="link" href="/en/bestPractices/" data-v-38ede35f><span class="text" data-v-38ede35f>最佳实践(English)</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-38ede35f><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"bestpractices_index.md\":\"d261e35a\",\"docs_intro_index.md\":\"aad5e579\",\"docs_model_index.md\":\"355427c4\",\"docs_persistence_index.md\":\"ea3b368a\",\"docs_subscribe_index.md\":\"ee84e4ef\",\"docs_typescript_index.md\":\"0804ac01\",\"drivers_cookie.md\":\"3d830375\",\"drivers_custom-driver.md\":\"c228091c\",\"drivers_dexie.md\":\"04fddcc8\",\"drivers_localstorage.md\":\"bfadbeb0\",\"drivers_taro.md\":\"9fe42d07\",\"en_docs_intro_index.md\":\"3ecd2769\",\"en_docs_model_index.md\":\"6696ec8f\",\"en_docs_persistence_index.md\":\"0a147c8e\",\"en_docs_subscribe_index.md\":\"27c67d21\",\"en_docs_typescript_index.md\":\"6e0eb154\",\"en_drivers_cookie.md\":\"5ce7e02b\",\"en_drivers_custom-driver.md\":\"ec4d180a\",\"en_drivers_dexie.md\":\"bc5f191c\",\"en_drivers_localstorage.md\":\"9bdfc469\",\"en_drivers_taro.md\":\"747b0889\",\"en_index.md\":\"699ce8c5\",\"en_migrations_v3.md\":\"86e4acb6\",\"en_migrations_v4.md\":\"e12f25ee\",\"en_others_index.md\":\"884e2b98\",\"index.md\":\"456daac7\",\"migrations_v3.md\":\"15dbf27f\",\"migrations_v4.md\":\"15ab3202\",\"others_index.md\":\"fec7689c\"}")</script>
    <script type="module" async src="/assets/app.cb718f31.js"></script>
    
  </body>
</html>